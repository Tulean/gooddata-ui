openapi: 3.0.0
info:
  description: API for getting audit events for users or domains
  version: 1.0.0
  title: CFAL Public API
tags:
  - name: auditEvents
    description: API for Audit Events listing
paths:
  "/account/profile/{userId}/auditEvents":
    get:
      tags:
        - auditEvents
      summary: Get a list of audit events of the given user in current domain.
      description: >-
        Returns a paged list of audit events for a specific user. For more
        information about audit events, see Auditing Platform Events.

        A domain admin can list audit events for any user in their domain. A user can list only their own events.
      parameters:
        - name: userId
          in: path
          description: The person's public ID
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/offsetParam"
        - $ref: "#/components/parameters/limitParam"
        - $ref: "#/components/parameters/fromParam"
        - $ref: "#/components/parameters/toParam"
        - $ref: "#/components/parameters/typeParam"
      responses:
        "200":
          description: A list of AuditEvents
          content:
            "*/*":
              schema:
                $ref: "#/components/schemas/AuditEvents"
        "400":
          description: Bad request
          content:
            "*/*":
              schema:
                $ref: "#/components/schemas/ErrorStructure"
        "401":
          description: Unauthorized
          content:
            "*/*":
              schema:
                $ref: "#/components/schemas/ErrorStructure"
        "500":
          description: Internal error
          content:
            "*/*":
              schema:
                $ref: "#/components/schemas/ErrorStructure"
  "/domains/{domainId}/auditEvents":
    get:
      tags:
        - auditEvents
      summary: Get a list of audit events for the domain
      description: >-
        Returns a paged list of audit events for a specific domain. For more
        information about audit events, see Auditing Platform Events.

        You must be a domain admin to perform this operation.
      parameters:
        - name: domainId
          in: path
          description: Domain ID
          required: true
          schema:
            type: string
        - $ref: "#/components/parameters/offsetParam"
        - $ref: "#/components/parameters/limitParam"
        - $ref: "#/components/parameters/fromParam"
        - $ref: "#/components/parameters/toParam"
        - $ref: "#/components/parameters/typeParam"
      responses:
        "200":
          description: A list of AuditEvents
          content:
            "*/*":
              schema:
                $ref: "#/components/schemas/AuditEvents"
        "400":
          description: Bad request
          content:
            "*/*":
              schema:
                $ref: "#/components/schemas/ErrorStructure"
        "401":
          description: Unauthorized
          content:
            "*/*":
              schema:
                $ref: "#/components/schemas/ErrorStructure"
        "500":
          description: Internal error
          content:
            "*/*":
              schema:
                $ref: "#/components/schemas/ErrorStructure"
servers:
  - url: /gdc
components:
  parameters:
    offsetParam:
      name: offset
      in: query
      description: The identifier of the first record (for paging)
      required: false
      schema:
        type: string
    limitParam:
      name: limit
      in: query
      description: The maximum number of records per page
      required: false
      schema:
        type: integer
        minimum: 1
    fromParam:
      name: from
      in: query
      description: Specify minimal timestamp of audit events to be returned
      required: false
      schema:
        type: string
        format: date-time
    toParam:
      name: to
      in: query
      description: Specify maximal timestamp of audit events to be returned
      required: false
      schema:
        type: string
        format: date-time
    typeParam:
      name: type
      in: query
      description: Specify filter on type of events to be returned by this API
      required: false
      schema:
        type: string
  schemas:
    AuditEvent:
      properties:
        id:
          type: string
          example: 123-324-123
          description: The unique ID of the event.
        userLogin:
          type: string
          example: email@gooddata.com
          description: The type of the event.
        occurred:
          type: string
          format: date-time
          description: The timestamp when the event occurred.
        recorded:
          type: string
          format: date-time
          description: The timestamp when the event was recorded by the system (the from
            and to parameters apply to this value).
        userIp:
          type: string
          example: 127.0.0.1
          description: Public IP of the user who initiated this particular action
        success:
          type: boolean
          example: true
        type:
          type: string
          example: login
          description: Type of the event
        params:
          type: object
          example:
            foo: bar
          description: A string/string map of additional context information.
          additionalProperties:
            type: string
        links:
          type: object
          example:
            profile: /account/profile/abc/auditEvents
          description: A string/string map of the affected resources.
          additionalProperties:
            type: string
      title: JSON representation of one audit event
    AuditEvents:
      title: JSON representation of a list of audit events
      properties:
        events:
          properties:
            items:
              type: array
              items:
                $ref: "#/components/schemas/AuditEvent"
            paging:
              type: object
              additionalProperties:
                type: string
              example:
                next: /gdc/domains/default/auditEvents?offset=123-324-123
            links:
              type: object
              additionalProperties:
                type: string
              example:
                self: /gdc/domains/default/auditEvents
    ErrorStructure:
      title: Error structure
      properties:
        error:
          properties:
            errorClass:
              type: string
            trace:
              type: string
            message:
              type: string
            component:
              type: string
            errorId:
              type: string
            errorCode:
              type: string
            parameters:
              type: array
              items:
                type: object